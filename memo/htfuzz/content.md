# HTFuzz: Heap Operation Sequence Sensitive Fuzzing [ASE'22]

## Abstract

- heap の時間的脆弱性 (use-after-free, double-free, null ポインタデリファレンス) はヒープ操作の順番に敏感
- この脆弱性を効率的に発見するために従来のコードカバレッジファジングにヒープ操作のシーケンスのフィードバックを統合することが良い
- しかし, 既存手法には限界がある

<br/>

- HTFuzz を提案
- 以下の理由からファジングを利用
  - 実行時のヒープ操作シーケンスのカバレッジを増加させる
    - ヒープ操作シーケンスの制御フローを反映
  - これらの操作によってアクセスされるポインタの多様性を増加させる
    - データフローを反映
- (HTfuzz は実験の結果すごいらしい)

<br/>

## 1. Introduction

- 既存のファザーは一般にコードカバレッジフィードバックに依存している
  - AFL
  - TortoiseFuzz, Ankou: 補足的なフィードバックとして, よりエラーの発生しやすい箇所 (システムコールとループ反復など) を探索しようとする

<br/>

- しかし, ヒープの時間的脆弱性 (HT-Vuls) はコードカバレッジだけでなく, ヒープ操作のシーケンスにも敏感
- ファザーがポインタのデリファレンスコードを探索したとしても脆弱なヒープ操作のシーケンスを満たしていなければ, HT-Vuls を見逃すかも
- HT-Vuls はアクセスされたポインタとその前の操作シーケンスに密接に関係する

<br/>

- 研究者はファジング中にヒープ操作シーケンスを考慮するためのいくつかの解決案を提案している
- それらは脆弱性のある操作の候補を認識するために事前知識や静的解析に依存する
  - [UAFL](https://yuleisui.github.io/publications/icse20.pdf) : 静的解析を利用して HT-Vuls の候補となるヒープ操作を見つけ, ヒープ操作間の遷移を新しいフィードバックとして受け取り, ファザーをターゲットの操作シーケンスに誘導する
  - [LTL-Fuzzer](https://abhikrc.com/pdf/ICSE22-LTLFuzz.pdf) : 時間的な違反に関連する場所で計装し, ファザーがその場所を探索するように誘導する
  - [UAFuzz](https://www.usenix.org/system/files/raid20-nguyen.pdf) : ユーザによって事前に定義された UAF 箇所を探索するために有向ファジングを実行する
- 事前知識や静的解析に依存するため限界がある

<br/>

- HTFuzz : 事前に定義・分析された操作シーケンスの候補に依存しない, ヒープ操作シーケンスガイドファジング
- 限られた操作シーケンスの候補集合を探索することに集中せず, ヒープ操作シーケンスの多様性を高めることを提案する
- 具体的には
  - ヒープ操作シーケンスを追跡し, 
  - コードカバレッジに加えて新たなフィードバックを使用し, 
  - 多様性を高めるようにファザーを誘導する
- ヒープ操作シーケンスの多様性が高まれば, 潜在的な HT-Vuls を発見できる